# AI ë¶„ì„ ì„œë¹„ìŠ¤ ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### í†µí•© AI ë¶„ì„ í”„ë ˆì„ì›Œí¬
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Client (Flutter App)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Gateway (port 8080)                 â”‚
â”‚                     - ì¸ì¦/ì¸ê°€                          â”‚
â”‚                     - ë¼ìš°íŒ…                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               AI Analysis Service (port 8081)            â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Voice (30%)  â”‚  â”‚ Text (40%)   â”‚  â”‚SincNet (30%) â”‚  â”‚
â”‚  â”‚   Librosa    â”‚  â”‚  GPT-4o/     â”‚  â”‚  Deep        â”‚  â”‚
â”‚  â”‚              â”‚  â”‚  Gemini      â”‚  â”‚  Learning    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚     RAG      â”‚                      â”‚
â”‚                    â”‚ (Optional)   â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Firestore                         â”‚
â”‚                    - ë¶„ì„ ê²°ê³¼ ì €ì¥                      â”‚
â”‚                    - ì‹œê³„ì—´ ë°ì´í„°                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ë°°í¬ ì˜µì…˜

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½ (ê°€ìƒí™˜ê²½)

#### Windows (PowerShell)
```powershell
# ê°€ìƒí™˜ê²½ ì„¤ì • (SincNet í¬í•¨)
cd backend
.\setup_production_venv.ps1  # SincNet ì˜ì¡´ì„± í¬í•¨

# ê°€ìƒí™˜ê²½ í™œì„±í™”
.\venv_production\Scripts\Activate.ps1

# FFmpeg ì„¤ì • í™•ì¸ (M4A/MP3 ì²˜ë¦¬ í•„ìš”)
ffmpeg -version

# AI ì„œë¹„ìŠ¤ ì‹¤í–‰
cd ai-service
python -m uvicorn app.main:app --reload --port 8081
```

#### Linux/Mac
```bash
# ê°€ìƒí™˜ê²½ ì„¤ì • (SincNet í¬í•¨)
cd backend
bash setup_production_venv.sh  # SincNet ì˜ì¡´ì„± í¬í•¨

# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv_production/bin/activate

# FFmpeg ì„¤ì • í™•ì¸ (M4A/MP3 ì²˜ë¦¬ í•„ìš”)
ffmpeg -version

# AI ì„œë¹„ìŠ¤ ì‹¤í–‰
cd ai-service
python -m uvicorn app.main:app --reload --port 8081
```

### 2. Docker ë°°í¬ (ê¶Œì¥)

#### ì „ì²´ ìŠ¤íƒ ì‹¤í–‰
```bash
# Docker Composeë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose -f docker-compose.ai.yml up -d

# ì„œë¹„ìŠ¤ í™•ì¸
docker-compose -f docker-compose.ai.yml ps

# ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.ai.yml logs -f ai-service
```

#### ê°œë³„ ì„œë¹„ìŠ¤ ë¹Œë“œ
```bash
# AI ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ
cd backend/ai-service
docker build -t senior-mhealth-ai .

# ì‹¤í–‰
docker run -p 8081:8081 \
  -e GOOGLE_CLOUD_PROJECT=senior-mhealth-472007 \
  -e OPENAI_API_KEY=$OPENAI_API_KEY \
  -e GEMINI_API_KEY=$GEMINI_API_KEY \
  -e USE_RAG=true \
  senior-mhealth-ai
```

### 3. Google Cloud Run ë°°í¬ (í”„ë¡œë•ì…˜)

#### ì‚¬ì „ ì¤€ë¹„
```bash
# Google Cloud SDK ì„¤ì¹˜ í™•ì¸
gcloud --version

# í”„ë¡œì íŠ¸ ì„¤ì •
gcloud config set project senior-mhealth-472007

# ì¸ì¦
gcloud auth login
gcloud auth configure-docker
```

#### ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
cd backend/ai-service
bash deploy.sh
```

ë˜ëŠ” ìˆ˜ë™ ë°°í¬:
```bash
# ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
docker build -t gcr.io/senior-mhealth-472007/senior-mhealth-ai .
docker push gcr.io/senior-mhealth-472007/senior-mhealth-ai

# Cloud Run ë°°í¬
gcloud run deploy senior-mhealth-ai \
  --image gcr.io/senior-mhealth-472007/senior-mhealth-ai \
  --platform managed \
  --region asia-northeast3 \
  --memory 2Gi \
  --cpu 2 \
  --timeout 300 \
  --concurrency 10 \
  --max-instances 5 \
  --allow-unauthenticated \
  --set-env-vars="PROJECT_ID=senior-mhealth-472007,ENVIRONMENT=production,USE_RAG=true"
```

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜
```env
# Google Cloud
GOOGLE_CLOUD_PROJECT=senior-mhealth-472007

# AI API Keys
OPENAI_API_KEY=your_openai_api_key
GEMINI_API_KEY=your_gemini_api_key

# ì„œë¹„ìŠ¤ ì„¤ì •
ENVIRONMENT=development|production
USE_RAG=true|false

# SincNet ì„¤ì • (ìƒˆë¡œ ì¶”ê°€)
FFMPEG_PATH=/usr/local/bin/ffmpeg  # Linux/Mac
# FFMPEG_PATH=C:\Senior_MHealth\backend\ffmpeg\bin  # Windows
```

### ì„ íƒì  í™˜ê²½ ë³€ìˆ˜
```env
# ì„±ëŠ¥ íŠœë‹
MAX_WORKERS=4
TIMEOUT_SECONDS=300

# ë¡œê¹…
LOG_LEVEL=INFO|DEBUG|WARNING|ERROR

# SincNet ëª¨ë¸ ìºì‹œ
SINCNET_MODEL_DIR=/app/models  # Docker
# SINCNET_MODEL_DIR=C:\Senior_MHealth\backend\libraries\voice_analysis\analysis\sincnet\models  # Windows
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### í—¬ìŠ¤ ì²´í¬
```bash
# ë¡œì»¬
curl http://localhost:8081/health

# Cloud Run
curl https://senior-mhealth-ai-xxxxx-an.a.run.app/health
```

### ì˜ˆìƒ ì‘ë‹µ
```json
{
  "status": "healthy",
  "service": "ai-analysis",
  "timestamp": "2024-09-12T10:00:00",
  "components": {
    "voice_analysis": "ready",
    "text_analysis": "ready",
    "sincnet": "ready",
    "rag": "true"
  }
}
```

## ğŸ” API ì—”ë“œí¬ì¸íŠ¸

### 1. ìŒì„± ë¶„ì„ (í†µí•©)
```http
POST /analyze/voice
Content-Type: multipart/form-data

file: <audio_file>
request: {
  "user_id": "user123",
  "age": 75,
  "gender": "male",
  "use_rag": true,
  "include_trend": true
}
```

### 2. í…ìŠ¤íŠ¸ ë¶„ì„ (RAG í¬í•¨)
```http
POST /analyze/text
Content-Type: application/json

{
  "text": "ë¶„ì„í•  í…ìŠ¤íŠ¸",
  "use_rag": true,
  "age": 75,
  "gender": "female"
}
```

### 3. ëª¨ë¸ ìƒíƒœ í™•ì¸
```http
GET /models/status
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ë¦¬ì†ŒìŠ¤ í• ë‹¹
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 2GB, ê¶Œì¥ 4GB (SincNet ëª¨ë¸ ë¡œë”© ì‹œ ~200MB ì¶”ê°€ í•„ìš”)
- **CPU**: ìµœì†Œ 1 core, ê¶Œì¥ 2 cores (SincNet ì¶”ë¡  ì‹œ CPU ì‚¬ìš©)
- **íƒ€ì„ì•„ì›ƒ**: 300ì´ˆ (ìŒì„± íŒŒì¼ ì²˜ë¦¬ ê³ ë ¤)
- **ë””ìŠ¤í¬**: ìµœì†Œ 1GB (SincNet ëª¨ë¸ ìºì‹œ ~170MB)

### ìŠ¤ì¼€ì¼ë§ ì •ì±…
```yaml
# Cloud Run ìë™ ìŠ¤ì¼€ì¼ë§
min_instances: 0
max_instances: 5
concurrency: 10

# ë¶€í•˜ ê¸°ì¤€
cpu_utilization: 70%
memory_utilization: 80%
```

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **API í‚¤ ê´€ë¦¬**
   - Secret Manager ì‚¬ìš© ê¶Œì¥
   - í™˜ê²½ ë³€ìˆ˜ë¡œ ì£¼ì…
   - ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”© ê¸ˆì§€

2. **ì„œë¹„ìŠ¤ ê³„ì •**
   - ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
   - Firestore, Storage ì ‘ê·¼ ê¶Œí•œë§Œ ë¶€ì—¬

3. **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**
   - HTTPS ê°•ì œ
   - API Gateway í†µí•œ ì¸ì¦/ì¸ê°€

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œ

1. **librosa ì„¤ì¹˜ ì‹¤íŒ¨**
   ```bash
   # Docker ì‚¬ìš© ê¶Œì¥
   docker-compose -f docker-compose.ai.yml up
   ```

2. **ë©”ëª¨ë¦¬ ë¶€ì¡±**
   - Cloud Run ë©”ëª¨ë¦¬ ì¦ê°€: `--memory 4Gi`
   - ë™ì‹œ ì²˜ë¦¬ ìˆ˜ ê°ì†Œ: `--concurrency 5`

3. **íƒ€ì„ì•„ì›ƒ ì—ëŸ¬**
   - íƒ€ì„ì•„ì›ƒ ì¦ê°€: `--timeout 600`
   - ìŒì„± íŒŒì¼ í¬ê¸° ì œí•œ (10MB)

4. **RAG ì´ˆê¸°í™” ì‹¤íŒ¨**
   - Firebase ê¶Œí•œ í™•ì¸
   - embeddings.jsonl íŒŒì¼ ì¡´ì¬ í™•ì¸

5. **SincNet ê´€ë ¨ ë¬¸ì œ (ìƒˆë¡œ ì¶”ê°€)**
   - **ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨**: Firebase Storage ê¶Œí•œ í™•ì¸, ë¡œì»¬ ìºì‹œ ë””ë ‰í† ë¦¬ ê¶Œí•œ
   - **FFmpeg ì—†ìŒ**: M4A/MP3 ì²˜ë¦¬ ë¶ˆê°€ â†’ FFmpeg ì„¤ì¹˜ í•„ìš”
   - **PyTorch ì„¤ì¹˜**: CPU ë²„ì „ ì„¤ì¹˜ `pip install torch --index-url https://download.pytorch.org/whl/cpu`
   - **0.00 ê²°ê³¼ê°’**: Original SincNet ì•„í‚¤í…ì²˜ í™•ì¸ (200ms ìœˆë„ìš°, Layer Norm)

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] API í‚¤ ì„¤ì •
- [ ] ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ë°°ì¹˜
- [ ] Docker ì´ë¯¸ì§€ ë¹Œë“œ í…ŒìŠ¤íŠ¸
- [ ] **SincNet ëª¨ë¸ íŒŒì¼ í™•ì¸** (dep_model_10500_raw.pkl, insom_model_38800_raw.pkl)
- [ ] **FFmpeg ì„¤ì¹˜/ê²½ë¡œ í™•ì¸** (M4A/MP3 ì²˜ë¦¬ìš©)
- [ ] **PyTorch CPU ë²„ì „ ì„¤ì¹˜ í™•ì¸**

### ë°°í¬ í›„
- [ ] í—¬ìŠ¤ ì²´í¬ í™•ì¸
- [ ] ê° ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ì•Œë¦¼ ì„¤ì •
- [ ] **SincNet ë¶„ì„ í…ŒìŠ¤íŠ¸** (ì‹¤ì œ ìŒì„± íŒŒì¼ë¡œ)

## ğŸ”„ ì—…ë°ì´íŠ¸ í”„ë¡œì„¸ìŠ¤

1. **ì½”ë“œ ë³€ê²½**
   ```bash
   git checkout develop_lee
   git pull origin develop_lee
   ```

2. **ì´ë¯¸ì§€ ì¬ë¹Œë“œ**
   ```bash
   docker build -t gcr.io/senior-mhealth-472007/senior-mhealth-ai:v2 .
   docker push gcr.io/senior-mhealth-472007/senior-mhealth-ai:v2
   ```

3. **ë¡¤ë§ ì—…ë°ì´íŠ¸**
   ```bash
   gcloud run deploy senior-mhealth-ai \
     --image gcr.io/senior-mhealth-472007/senior-mhealth-ai:v2
   ```

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ:
1. ë¡œê·¸ í™•ì¸: `docker-compose logs` ë˜ëŠ” Cloud Run ì½˜ì†”
2. GitHub Issues ìƒì„±
3. íŒ€ ìŠ¬ë™ ì±„ë„ ë¬¸ì˜