# Week 6: Firebase Authentication 다중 사용자 인증 시스템 - 이론편

## 📚 학습 목표
사용자 인증의 핵심 개념을 이해하고, Firebase Authentication을 통해 안전한 다중 사용자 시스템을 구축하는 방법을 학습합니다.

## 🌟 핵심 개념

### 1. 인증(Authentication) vs 인가(Authorization)
**인증 (Authentication)**: "당신은 누구입니까?"
- 사용자의 신원을 확인하는 과정
- 예: 로그인 (아이디/비밀번호)

**인가 (Authorization)**: "무엇을 할 수 있습니까?"
- 인증된 사용자의 권한을 확인하는 과정
- 예: 관리자만 데이터 삭제 가능

```
인증 과정:
사용자 → 로그인 → 신원 확인 → 토큰 발급

인가 과정:
토큰 → 권한 확인 → 리소스 접근 허용/거부
```

### 2. JWT (JSON Web Token)
Firebase가 사용하는 토큰 방식

```
JWT 구조:
header.payload.signature

예시:
eyJhbGci.eyJ1aWQi.9eXiV4
    │         │        │
    │         │        └── 서명 (위조 방지)
    │         └── 페이로드 (사용자 정보)
    └── 헤더 (토큰 타입)
```

### 3. Custom Claims (사용자 정의 클레임)
사용자에게 추가 정보를 부여하는 방법

```javascript
// Custom Claims 예시
{
  uid: "user001",           // 기본 정보
  email: "user@example.com",
  // Custom Claims
  role: "caregiver",        // 역할
  permissions: ["read", "write"],  // 권한
  managedSeniors: ["senior001", "senior002"]  // 관리 대상
}
```

### 4. 역할 기반 접근 제어 (RBAC)
Senior MHealth의 사용자 역할 구조

```
👤 역할 계층:
├── 🔴 Admin (관리자)
│   └── 모든 권한
├── 🟡 Caregiver (보호자)
│   └── 담당 시니어 데이터 관리
└── 🟢 Senior (시니어)
    └── 자신의 데이터만 접근
```

## 🔧 주요 기능

### 인증 흐름 다이어그램
```
┌────────────┐     1. 로그인 요청     ┌──────────────┐
│   클라이언트  │ ──────────────────→ │   Firebase   │
│   (앱/웹)   │                      │     Auth     │
└────────────┘                      └──────────────┘
      ↑                                    │
      │                                    │ 2. 검증
      │                                    ↓
      │                            ┌──────────────┐
      │      4. ID Token 반환      │   사용자 DB   │
      └────────────────────────── │  (Firestore) │
                                   └──────────────┘
                                          │
                                          │ 3. Custom Claims 설정
                                          ↓
                                   ┌──────────────┐
                                   │ Cloud Functions│
                                   └──────────────┘
```

### 미들웨어 체인
```javascript
요청 → [인증 확인] → [역할 확인] → [권한 확인] → 리소스 접근
         ↓              ↓              ↓
      401 에러      403 에러      403 에러
   (미인증)       (권한없음)     (권한없음)
```

## 💡 용어 설명

| 용어 | 설명 | 예시 |
|-----|------|------|
| **Token** | 인증 증명서 | JWT 토큰 |
| **Session** | 로그인 상태 유지 | 24시간 유효 |
| **Middleware** | 중간 처리 계층 | 인증 체크 |
| **Claims** | 토큰 내 정보 | 역할, 권한 |
| **Bearer Token** | HTTP 헤더 인증 방식 | `Bearer eyJ...` |
| **Refresh Token** | 토큰 갱신용 | 7일 유효 |

## 📊 보안 모범 사례

### 비밀번호 정책
```javascript
비밀번호 요구사항:
✅ 최소 8자 이상
✅ 대문자 포함 (A-Z)
✅ 소문자 포함 (a-z)
✅ 숫자 포함 (0-9)
✅ 특수문자 포함 (@$!%*?&)

예시: Senior@2024!
```

### 보안 레벨
```
🔒 Level 1: 기본 인증
- 이메일/비밀번호

🔒🔒 Level 2: 강화 인증
- 이메일 검증
- 강력한 비밀번호 정책

🔒🔒🔒 Level 3: 최고 보안
- 2단계 인증 (2FA)
- 디바이스 신뢰
- 세션 관리
```

## 🎯 학습 체크리스트

- [ ] 인증과 인가의 차이 이해
- [ ] JWT 토큰 구조와 원리 파악
- [ ] Custom Claims 활용 방법 이해
- [ ] 역할 기반 접근 제어 구현 이해
- [ ] 미들웨어 체인 동작 원리 파악
- [ ] 보안 모범 사례 숙지

## 🔍 심화 개념

### 토큰 생명주기
```
생성 → 검증 → 갱신 → 만료 → 폐기
  │      │      │      │      │
  │      │      │      │      └─ 로그아웃
  │      │      │      └─ 24시간 후
  │      │      └─ 자동 갱신
  │      └─ 매 요청마다
  └─ 로그인 시
```

### Multi-Factor Authentication (MFA)
```javascript
// 2단계 인증 플로우
1. 비밀번호 입력 → 1차 인증
2. SMS/이메일 코드 → 2차 인증
3. 최종 인증 완료 → 토큰 발급
```

### 세션 관리
```javascript
// 동시 로그인 제한
const sessions = {
  maxConcurrent: 3,       // 최대 3개 디바이스
  timeout: 86400,         // 24시간
  refreshWindow: 3600,    // 1시간 전 갱신
};
```

## 🚀 다음 단계
Week 7에서는 Firebase Cloud Messaging을 사용하여 푸시 알림 시스템을 구현하고, 실시간 알림 기능을 추가합니다.